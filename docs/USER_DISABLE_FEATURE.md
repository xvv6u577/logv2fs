# 用户禁用功能说明

## 功能概述

新添加了用户禁用/启用功能，管理员可以通过界面禁用或启用普通用户账户。被禁用的用户状态会被设置为 "deleted"，此时用户无法使用服务。

## 功能特性

### 1. 用户状态管理
- **活跃状态 (plain)**: 用户可以正常使用服务
- **禁用状态 (deleted)**: 用户被禁用，无法使用服务
- **离线状态 (其他状态)**: 用户非活跃状态

### 2. 界面显示
- **状态标签**: 用户卡片中显示当前状态（在线/已禁用/离线）
- **颜色区分**: 
  - 绿色: 在线状态
  - 灰色: 已禁用状态  
  - 红色: 离线状态

### 3. 操作按钮
- **用户卡片**: 每个非管理员用户卡片都有禁用/启用按钮
- **用户详情**: 在用户详情模态框中也提供相同操作
- **动态切换**: 根据用户当前状态显示相应的操作按钮

### 4. 权限控制
- 只有管理员可以执行禁用/启用操作
- 管理员账户不能被禁用
- 普通用户无法看到或使用此功能

## API端点

### MongoDB版本
- `PUT /v1/disableuser/:name` - 禁用用户
- `PUT /v1/enableuser/:name` - 启用用户

### PostgreSQL版本  
- `PUT /v1/disableuser/:name` - 禁用用户
- `PUT /v1/enableuser/:name` - 启用用户

## 前端组件更新

### 1. 样式增强
```javascript
// 新增样式类
buttonWarning: "bg-orange-600 hover:bg-orange-700 text-white focus:ring-orange-500",
buttonSuccess: "bg-green-600 hover:bg-green-700 text-white focus:ring-green-500",
badgeDisabled: "bg-gray-900 text-gray-300",
```

### 2. 功能函数
- `disableUser(user)` - 禁用用户功能
- `enableUser(user)` - 启用用户功能
- 支持确认对话框和错误处理

### 3. 过滤功能
- 状态过滤器新增"已禁用"选项
- 支持按用户状态筛选显示

## 使用流程

### 禁用用户
1. 在用户列表中找到要禁用的用户
2. 点击"禁用"按钮（橙色）
3. 确认操作
4. 用户状态自动更新为"已禁用"

### 启用用户
1. 在用户列表中找到已禁用的用户
2. 点击"启用"按钮（绿色）  
3. 确认操作
4. 用户状态自动更新为"在线"

## 安全考虑

1. **权限验证**: 所有API都验证管理员权限
2. **管理员保护**: 管理员账户无法被禁用
3. **确认机制**: 所有操作都需要用户确认
4. **日志记录**: 所有禁用/启用操作都会被记录到服务器日志

## 技术实现

### 后端实现
- MongoDB和PostgreSQL双数据库支持
- 统一的错误处理和日志记录
- RESTful API设计

### 前端实现  
- React组件化设计
- 状态管理使用Redux
- 响应式界面适配
- 用户友好的反馈机制

## 注意事项

1. 禁用用户不会删除用户数据，只是更改状态
2. 被禁用的用户无法获取订阅链接和配置文件
3. 管理员可以随时启用已禁用的用户
4. 功能同时支持MongoDB和PostgreSQL数据库 